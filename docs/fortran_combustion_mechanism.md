# Fortranä»£ç ä¸­çƒ­è§£äº§ç‰©ç‡ƒçƒ§æœºåˆ¶åˆ†æ

## ğŸ”¥ æ ¸å¿ƒå‘ç°ï¼šå‡è®¾ç¬æ—¶å®Œå…¨ç‡ƒçƒ§ï¼ˆéåŠ¨åŠ›å­¦æ§åˆ¶ï¼‰

### 1. çƒ­è§£äº§ç‰©ç‡ƒçƒ§å¤„ç†æœºåˆ¶

#### pyrolyå­ç¨‹åºï¼ˆLine 1032-1090ï¼‰

**å…³é”®ä»£ç é€»è¾‘ï¼š**

```fortran
! è®¡ç®—ç‡ƒçƒ§æ‰€éœ€æ°§æ°”é‡ï¼ˆLine 1057ï¼‰
doxy = wl*(xh2/4. + xco/56. + xch4/8. + xtar/10.4)*(32./100.)
      
! åˆ¤æ–­æ°§æ°”æ˜¯å¦è¶³å¤Ÿï¼ˆLine 1059-1080ï¼‰
goxyex = goxy - doxy*fcoal

if(goxyex < 0.) then
    ! æ°§æ°”ä¸è¶³ï¼šæŒ‰ä¼˜å…ˆçº§éƒ¨åˆ†ç‡ƒçƒ§
    ! ä¼˜å…ˆé¡ºåºï¼štar(å…¨çƒ§) > CH4 > CO > H2
    cop = (abs(goxyex)/fcoal)*(28./16.)
    if(cop > copmax) then
        ch4p = (cop-copmax)*(16./(4.*28.))
        if(ch4p > ch4pmx) then
            h2p = (ch4p-ch4pmx)*(4.*2./16.)
        endif
    endif
else
    ! æ°§æ°”å……è¶³ï¼šå®Œå…¨ç‡ƒçƒ§
    cop = 0.    ! æ— COæ®‹ç•™
    ch4p = 0.   ! æ— CH4æ®‹ç•™
    h2p = 0.    ! æ— H2æ®‹ç•™
endif

! ç‡ƒçƒ§çƒ­è®¡ç®—ï¼ˆLine 1087-1088ï¼‰ï¼šç›´æ¥ç”¨æ ‡å‡†ç‡ƒçƒ§ç„“
rheat1 = wl*(xh2*ht(1)/2. + xco*ht(2)/28. + xch4*ht(3)/16. +
     & xtar*ht(4)/78.)/100. - cop*ht(2)/28. - ch4p*ht(3)/16. - h2p*ht(1)/2.
```

**ç‡ƒçƒ§ç„“å€¼ï¼ˆheatå­ç¨‹åºï¼ŒLine 1011-1014ï¼‰ï¼š**
```fortran
ht298(1) = -57798.  cal/mol  ! H2 + 0.5O2 â†’ H2O
ht298(2) = -66911.6 cal/mol  ! CO + 0.5O2 â†’ CO2  
ht298(3) = -191760. cal/mol  ! CH4 + 2O2 â†’ CO2+2H2O
ht298(4) = -749420. cal/mol  ! C6H6 + 7.5O2 â†’ 6CO2+3H2O
```

---

### 2. åŒ–å­¦è®¡é‡å…³ç³»

**ä»£ç ä¸­çš„åŒ–å­¦è®¡é‡ç³»æ•°ï¼ˆLine 1057ï¼‰ï¼š**

| ç»„åˆ† | ç³»æ•° | ååº”æ–¹ç¨‹ | O2éœ€æ±‚ |
|------|------|----------|--------|
| H2   | xh2/4 | H2 + 0.5O2 â†’ H2O | 0.25 mol O2/mol H2 |
| CO   | xco/56 | CO + 0.5O2 â†’ CO2 | 0.0179 mol O2/mol CO |
| CH4  | xch4/8 | CH4 + 2O2 â†’ CO2+2H2O | 0.125 mol O2/mol CH4 |
| tar  | xtar/10.4 | C6H6 + 7.5O2 â†’ 6CO2+3H2O | 0.096 mol O2/mol tar |

---

### 3. ç‡ƒçƒ§åŒºåˆ¤æ®ï¼ˆLine 345-350ï¼‰

```fortran
if(poxyin .gt. 0.05) then
    ! ç‡ƒçƒ§åŒºï¼ˆæœ‰æ°§æ°”ï¼‰
    hloss = fcoal*abs(rheat1)*hl/100.   ! hl=30%çƒ­æŸå¤±
else
    ! æ°”åŒ–åŒºï¼ˆæ— æ°§æ°”ï¼‰
    tw = 2100.-600.*hs/height
    hloss = u0*3.14*dt*float(nc)*delh*(tg-tw)
endif
```

**åˆ¤æ®ï¼š**
- `pO2 > 0.05 atm` â†’ **ç‡ƒçƒ§åŒº**ï¼ˆæŒ¥å‘åˆ†ç¬æ—¶ç‡ƒçƒ§ï¼‰
- `pO2 â‰¤ 0.05 atm` â†’ **æ°”åŒ–åŒº**ï¼ˆå¼‚ç›¸ååº”ä¸»å¯¼ï¼‰

---

### 4. å¼‚ç›¸ååº”é€Ÿç‡è®¡ç®—

#### A. Char-O2ååº”ï¼ˆLine 437-458ï¼‰

**ä½¿ç”¨é˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦ + Unreacted Shrinking Coreæ¨¡å‹ï¼š**

```fortran
! æ”¶ç¼©æ ¸å› å­
Y = ((1.-wl/100.)/(1.-swl/100.))**0.333  ! Y = rc/R

! è¡¨é¢ååº”é€Ÿç‡å¸¸æ•°ï¼ˆé˜¿ç´¯å°¼ä¹Œæ–¯æ–¹ç¨‹ï¼‰
agurr2 = -q/ts              ! q = 17967 cal/mol
earr2 = exp(agurr2)
ks = c*earr2                ! c = 8710

! æ€»ååº”é€Ÿç‡
kover = 1/(1/kdiff + (Y-1)/(Y*kdash) + 1/(Y^2*ks))
```

**åŠ¨åŠ›å­¦å‚æ•°ï¼ˆLine 31ï¼‰ï¼š**
```fortran
data a,b,c,q /4.92e5, 8900., 8710., 17967./
! c = 8710  : C+O2è¡¨é¢ååº”æŒ‡å‰å› å­ (g/cmÂ²Â·atmÂ·s)
! q = 17967 : C+O2æ´»åŒ–èƒ½ (cal/mol)
```

#### B. å…¶ä»–å¼‚ç›¸ååº”ï¼ˆLine 626-675ï¼‰

**è°ƒç”¨ä¸“é—¨å­ç¨‹åºï¼ˆéƒ½ä½¿ç”¨é˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦ï¼‰ï¼š**
- `cbstm`: C + H2O â†’ CO + H2
- `cbco2`: C + CO2 â†’ 2CO
- `cbhym`: C + H2 â†’ CH4

#### C. å‡ç›¸å‚¬åŒ–ååº”ï¼ˆLine 572-588ï¼‰

- `wgshift`: CO + H2O â‡Œ CO2 + H2 (æ°´ç…¤æ°”å˜æ¢)
- `ch4ref`: CH4 + H2O â†’ CO + 3H2 (ç”²çƒ·é‡æ•´)

---

## âœ… å›ç­”æ‚¨çš„é—®é¢˜

### Q1: çƒ­è§£äº§ç‰©ç‡ƒçƒ§å¦‚ä½•å¤„ç†ï¼Ÿ

**ç­”ï¼šå‡è®¾ç¬æ—¶å®Œå…¨ç‡ƒçƒ§ï¼ˆéåŠ¨åŠ›å­¦æ§åˆ¶ï¼‰**

å¤„ç†æµç¨‹ï¼š
1. è®¡ç®—ç†è®ºéœ€æ°§é‡ï¼š`O2_demand = Î£(ç‡ƒæ–™i Ã— åŒ–å­¦è®¡é‡ç³»æ•°i)`
2. åˆ¤æ–­æ°§æ°”æ˜¯å¦å……è¶³
3. **å……è¶³**ï¼šå…¨éƒ¨ç‡ƒçƒ§å®Œï¼ˆcop=ch4p=h2p=0ï¼‰
4. **ä¸è¶³**ï¼šæŒ‰ä¼˜å…ˆçº§éƒ¨åˆ†ç‡ƒçƒ§
5. çƒ­é‡è®¡ç®—ï¼šç›´æ¥ç”¨æ ‡å‡†ç‡ƒçƒ§ç„“ï¼ˆä¸è€ƒè™‘ç‡ƒçƒ§é€Ÿç‡ï¼‰

**å…³é”®ï¼šè¿™æ˜¯ä¸€ä¸ª"å…¨å±€å¹³è¡¡"è€Œé"é€Ÿç‡æ§åˆ¶"çš„è¿‡ç¨‹ï¼**

---

### Q2: å‰å‡ ä¸ªCellçš„ååº”é€Ÿç‡æ˜¯å¦ç”¨é˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦ï¼Ÿ

**ç­”ï¼šåˆ†æƒ…å†µå¤„ç†**

#### âœ… ä½¿ç”¨é˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦çš„ååº”ï¼š

1. **çƒ­è§£ååº”** (Line 278-291):
   ```
   dV/dt = aÂ·exp(-E/RT)Â·(V*-V)
   a = 4.92Ã—10âµ, E = 8900 cal/mol
   ```

2. **å¼‚ç›¸ååº”** (Char-O2, Char-H2O, Char-CO2, Char-H2):
   ```
   k_s = cÂ·exp(-E/RT)
   rate = k_overÂ·P_eff
   ```

3. **å‡ç›¸å‚¬åŒ–ååº”** (WGS, MSR):
   ```
   rate = k(T)Â·f(åˆ†å‹)
   ```

#### âŒ **ä¸ä½¿ç”¨**é˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦çš„ååº”ï¼š

1. **æŒ¥å‘åˆ†ç‡ƒçƒ§** (H2, CO, CH4, tarä¸O2):
   - å‡è®¾ç¬æ—¶å®Œå…¨ç‡ƒçƒ§
   - åªç”¨åŒ–å­¦è®¡é‡ + ç‡ƒçƒ§ç„“
   - **æ— é€Ÿç‡æ–¹ç¨‹**

---

## ğŸ¯ æ ¸å¿ƒç»“è®º

### ç‡ƒçƒ§åŒºï¼ˆå‰å‡ ä¸ªCellï¼‰çš„å¤„ç†é€»è¾‘ï¼š

```
Cell 0-3 (pO2 > 0.05 atm):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. çƒ­è§£ï¼šé˜¿ç´¯å°¼ä¹Œæ–¯åŠ¨åŠ›å­¦ âœ“          â”‚
â”‚    dV/dt = aÂ·exp(-E/RT)Â·(V*-V)        â”‚
â”‚                                         â”‚
â”‚ 2. æŒ¥å‘åˆ†ç‡ƒçƒ§ï¼šç¬æ—¶å‡è®¾ âœ—             â”‚
â”‚    H2/CO/CH4 + O2 â†’ products (instant) â”‚
â”‚    ä»…ç”¨åŒ–å­¦è®¡é‡ + ç‡ƒçƒ§ç„“              â”‚
â”‚                                         â”‚
â”‚ 3. Char-O2ï¼šæ”¶ç¼©æ ¸æ¨¡å‹ âœ“              â”‚
â”‚    k_s = 8710Â·exp(-17967/T)           â”‚
â”‚    rate = k_overÂ·P_eff                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸è®ºæ–‡Table IIçš„å®Œç¾å¯¹åº”ï¼š

**è®ºæ–‡Page 5, Table IIï¼š**

| Zone | Gas Reactions | Treatment |
|------|---------------|-----------|
| Pyrolysis & Combustion | H2_Ox, CO_Ox, CH4_Ox | **Complete** |
| Combustion & Gasification | H2_Ox, CO_Ox, CH4_Ox | **Complete** |
| Gasification | WGS, MSR | Equilibrium |

**"Complete"çš„å«ä¹‰å°±æ˜¯ï¼šç¬æ—¶å®Œå…¨ç‡ƒçƒ§ï¼**

---

## âš ï¸ æ‚¨çš„Pythonä»£ç é—®é¢˜è¯Šæ–­

### å½“å‰å®ç°çš„é—®é¢˜ï¼š

```python
# kinetics_service.py - æ‚¨è®¡ç®—äº†ç‡ƒçƒ§é€Ÿç‡
r_homo['CH4_Ox'] = k * C_CH4 * C_O2  # åŠ¨åŠ›å­¦é€Ÿç‡
```

### Fortranä»£ç çš„å®é™…åšæ³•ï¼š

```fortran
! ç›´æ¥å‡è®¾å®Œå…¨ç‡ƒçƒ§
if(goxy > doxy*fcoal) then
    ch4p = 0.              ! å…¨éƒ¨çƒ§å®Œ
    rheat = wl*xch4*ht(3)/16.  ! ç›´æ¥ç”¨ç‡ƒçƒ§ç„“
endif
```

### å¯¼è‡´çš„åæœï¼š

1. **èƒ½é‡ä¸å®ˆæ’**ï¼š
   - Î”H = +2.87 MWï¼ˆç„“ä¸Šå‡ï¼Ÿï¼Ÿï¼‰
   - Q_reaction = 589 MWï¼ˆååº”çƒ­å·¨å¤§ï¼‰
   - æ¯”å€¼ = 0.005ï¼ˆä¸¥é‡ä¸åŒ¹é…ï¼‰

2. **æ ¹æœ¬åŸå› **ï¼š
   - æ‚¨ç”¨**åŠ¨åŠ›å­¦é€Ÿç‡**è®¡ç®— â†’ ååº”é€Ÿç‡ Ã— ç‡ƒçƒ§ç„“ = å·¨å¤§çƒ­é‡
   - ä½†åŒæ—¶ç„“å˜è®¡ç®—ç”¨çš„æ˜¯**å…¨å±€å¹³è¡¡** â†’ ç„“å˜å¾ˆå°
   - ä¸¤è€…ä¸ä¸€è‡´ï¼

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®Œå…¨éµå¾ªFortrané€»è¾‘ï¼ˆæ¨èï¼‰

```python
def _calc_combustion_zone(self, current, phys, gas_src):
    """
    ç‡ƒçƒ§åŒºï¼ˆpO2 > 0.05 atmï¼‰ï¼šå‡è®¾æŒ¥å‘åˆ†ç¬æ—¶å®Œå…¨ç‡ƒçƒ§
    """
    avail = [max(self.inlet.gas_moles[i] + gas_src[i], 0.0) for i in range(8)]
    
    # è®¡ç®—ç†è®ºéœ€æ°§é‡
    O2_demand = (
        avail[1] * 2.0 +      # CH4éœ€è¦2 O2
        avail[2] * 0.5 +      # COéœ€è¦0.5 O2
        avail[5] * 0.5        # H2éœ€è¦0.5 O2
    )
    
    O2_available = avail[0]
    
    if O2_available >= O2_demand:
        # å®Œå…¨ç‡ƒçƒ§
        r_homo = {
            'CH4_Ox': avail[1] * 0.99,
            'CO_Ox': avail[2] * 0.99,
            'H2_Ox': avail[5] * 0.99,
            'WGS': 0.0, 'RWGS': 0.0, 'MSR': 0.0
        }
    else:
        # æŒ‰ä¼˜å…ˆçº§éƒ¨åˆ†ç‡ƒçƒ§
        remaining_O2 = O2_available
        
        # Priority: CH4 > CO > H2
        r_CH4 = min(avail[1], remaining_O2/2.0) * 0.99
        remaining_O2 -= r_CH4 * 2.0
        
        r_CO = min(avail[2], remaining_O2/0.5) * 0.99
        remaining_O2 -= r_CO * 0.5
        
        r_H2 = min(avail[5], remaining_O2/0.5) * 0.99
        
        r_homo = {
            'CH4_Ox': r_CH4,
            'CO_Ox': r_CO,
            'H2_Ox': r_H2,
            'WGS': 0.0, 'RWGS': 0.0, 'MSR': 0.0
        }
    
    return r_homo
```

### æ–¹æ¡ˆ2ï¼šåˆ†åŒºå¤„ç†

```python
# cell.py
def _calc_rates(self, current, phys, gas_src):
    pO2 = current.P * (current.gas_moles[0] / current.total_gas_moles)
    
    if pO2 > 5000:  # > 0.05 atm (å‡è®¾æ€»å‹4 MPa)
        # ç‡ƒçƒ§åŒºï¼šç¬æ—¶ç‡ƒçƒ§å‡è®¾
        r_homo = self._instant_combustion(current, phys, gas_src)
    else:
        # æ°”åŒ–åŒºï¼šåŠ¨åŠ›å­¦é€Ÿç‡
        r_homo = self.kinetics.calc_homogeneous_rates(current, self.V)
    
    # å¼‚ç›¸ååº”å§‹ç»ˆç”¨åŠ¨åŠ›å­¦
    r_het = self.kinetics.calc_heterogeneous_rates(...)
    
    return r_het, r_homo, phi
```

### æ–¹æ¡ˆ3ï¼šä¿®æ”¹èƒ½é‡å¹³è¡¡è®¡ç®—

å¦‚æœåšæŒç”¨åŠ¨åŠ›å­¦é€Ÿç‡ï¼Œåˆ™å¿…é¡»ç¡®ä¿ï¼š

```python
# ç‡ƒçƒ§çƒ­ = ååº”é€Ÿç‡ç§¯åˆ†
Q_reaction_integrated = Î£(r_i Ã— Î”H_i Ã— Î”t)

# ç„“å˜ = å‡ºå£ç„“ - å…¥å£ç„“
Î”H = H_out - H_in

# å¿…é¡»æ»¡è¶³ï¼šÎ”H â‰ˆ -Q_reaction_integrated
```

---

## ğŸ“š å…³é”®å‚è€ƒ

**Fortranä»£ç å…³é”®ä½ç½®ï¼š**
- Line 314-330: pyrolyå­ç¨‹åºè°ƒç”¨ï¼ˆçƒ­è§£äº§ç‰©å¤„ç†ï¼‰
- Line 1032-1090: pyrolyå­ç¨‹åºå®šä¹‰ï¼ˆç¬æ—¶ç‡ƒçƒ§é€»è¾‘ï¼‰
- Line 1057: åŒ–å­¦è®¡é‡ç³»æ•°
- Line 1087-1088: ç‡ƒçƒ§çƒ­è®¡ç®—
- Line 345-350: ç‡ƒçƒ§åŒºåˆ¤æ®

**è®ºæ–‡å…³é”®æ®µè½ï¼š**
- Page 4, Equation 9-10: "Reactions are assumed complete"
- Page 5, Table II: "Gas phase reactions in combustion zone: Complete"

**è¿™å®Œç¾è§£é‡Šäº†ä¸ºä»€ä¹ˆæ‚¨çš„æ¨¡å‹å‡ºç°èƒ½é‡ä¸å®ˆæ’ï¼**
