# Fortranä»£ç ä¸­é¢—ç²’æ¸©åº¦ä¸æ°”ç›¸æ¸©åº¦çš„è®¡ç®—æ–¹æ³•

## æ ¸å¿ƒæ€æƒ³ï¼šåˆ†æ­¥è¿­ä»£æ±‚è§£

### ğŸ”„ æ•´ä½“æ±‚è§£æµç¨‹

```
å¯¹æ¯ä¸ªCell:
  1. å‡è®¾æ°”ç›¸æ¸©åº¦ Tg (åˆå§‹çŒœæµ‹)
  2. åŸºäº Tgï¼Œæ±‚è§£å›ºç›¸æ¸©åº¦ Ts (ç¬æ€æ±‚è§£)
  3. åŸºäº Ts å’Œ Tgï¼Œè®¡ç®—ååº”é€Ÿç‡
  4. æ£€æŸ¥èƒ½é‡å¹³è¡¡ï¼Œè°ƒæ•´ Tg
  5. é‡å¤æ­¥éª¤2-4ç›´åˆ°æ”¶æ•›
```

---

## ğŸ“Š Part 1: å›ºç›¸é¢—ç²’æ¸©åº¦è®¡ç®— (Ts)

### ç‰©ç†æ¨¡å‹ï¼šç¬æ€çƒ­ä¼ å¯¼ + è¾å°„

**ä»£ç ä½ç½®**: Line 264-274

```fortran
110   condut = (7.7e-7)*((tg+ts)**0.75)
      ct = -(3./(dens*cps*r))*(condut/r + ef*sigma*4.*tg**3)*deltim
      if(abs(ct) .gt. 25.) then
          ect = 1.0e-12
      else 
          ect = exp(ct)
      endif
      delts = (tg-(tg-ts)*ect)-ts
      tsm = ts+delts/2.
      ts = ts+delts
```

### ç‰©ç†æ„ä¹‰

**1. å¯¼çƒ­ç³»æ•°ï¼ˆæ¸©åº¦ç›¸å…³ï¼‰**
```
condut = 7.7Ã—10â»â· Ã— (Tg + Ts)^0.75  [cal/(cmÂ·sÂ·K)]
```

**2. ç»¼åˆä¼ çƒ­ç³»æ•° ct**
```
ct = -(3 / (ÏsÂ·CpsÂ·r)) Ã— (Î»/r + ÎµÂ·ÏƒÂ·4TgÂ³) Ã— Î”t

å…¶ä¸­ï¼š
- ç¬¬ä¸€é¡¹ Î»/r: å¯¼çƒ­ä¼ é€’
- ç¬¬äºŒé¡¹ ÎµÂ·ÏƒÂ·4TgÂ³: è¾å°„ä¼ çƒ­ï¼ˆçº¿æ€§åŒ–ï¼‰
- å› å­ 3/(ÏsÂ·CpsÂ·r): çƒå½¢é¢—ç²’å‡ ä½•å› å­
```

**3. æ¸©åº¦å˜åŒ–æ±‚è§£ï¼ˆæŒ‡æ•°è¡°å‡å½¢å¼ï¼‰**
```
Ts(t+Î”t) = Tg - (Tg - Ts(t)) Ã— exp(ct)
```

è¿™æ˜¯ä¸€é˜¶ODEçš„è§£æè§£ï¼š
```
dTs/dt = Î±(Tg - Ts)
â†’ Ts(t) = Tg - (Tg - Tsâ‚€)e^(-Î±t)
```

**4. å¹³å‡æ¸©åº¦ç”¨äºååº”é€Ÿç‡**
```fortran
tsm = ts + delts/2.    ! æ—¶é—´æ­¥å†…å¹³å‡æ¸©åº¦
if (tsm .gt. 1250.) tsm = 1250.  ! é™æ¸©ä¿æŠ¤
```

---

## ğŸŒ¡ï¸ Part 2: æ°”ç›¸æ¸©åº¦è®¡ç®— (Tg)

### æ±‚è§£ç­–ç•¥ï¼šWegsteinè¿­ä»£æ³•

**ä»£ç ä½ç½®**: Line 342-412

### Step 1: è®¡ç®—èƒ½é‡ä¸å¹³è¡¡

```fortran
call enthal(tg,ts,fcoal,fash,wl,cps,enth)
tohup = (enth-enthin)/fcoal
hloss = fcoal*abs(rheat1)*hl/100.
htexc = -rheat1-tohup-hloss/fcoal
```

**èƒ½é‡æ–¹ç¨‹**ï¼š
```
htexc = H_reaction + H_out - H_in - H_loss = 0 (ç›®æ ‡)
```

### Step 2: è®¡ç®—æ¸©åº¦ä¿®æ­£é‡

```fortran
deltg = (htexc*fcoal) / (goxy*cp(1)/32. + gsteam*cp(2)/18. + ... )
```

**ç‰©ç†æ„ä¹‰**ï¼š
```
Î”Tg = Q_excess / (Î£ miÂ·Cpi)
```

### Step 3: WegsteinåŠ é€Ÿæ”¶æ•›

```fortran
! Line 393-398
tgas(3) = (tgas(1)*ftg(2) - tgas(2)*ftg(1)) / 
          (tgas(1) - tgas(2) + ftg(2) - ftg(1))
```

**Wegsteinå…¬å¼**ï¼š
```
       Tgâ‚Â·f(Tgâ‚‚) - Tgâ‚‚Â·f(Tgâ‚)
Tgâ‚ƒ = â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
       Tgâ‚ - Tgâ‚‚ + f(Tgâ‚‚) - f(Tgâ‚)

å…¶ä¸­ f(Tg) = Tg + Î”Tg(Tg)
```

### æ”¶æ•›åˆ¤æ®ï¼ˆä¸‰é‡æ£€æŸ¥ï¼‰

```fortran
if(abs(errtg) .le. .02) goto 800        ! ç›¸å¯¹è¯¯å·® < 2%
if(abs(htexc) .le. 5.0) goto 800        ! èƒ½é‡æ®‹å·® < 5 cal
if(abs(dhtex) .le. 0.1) goto 800        ! èƒ½é‡æ¯” < 10%
```

---

## ğŸ” å®Œæ•´è¿­ä»£æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹åŒ–: Tg_guess, Ts_inlet     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›ºç›¸ç¬æ€æ±‚è§£ (ncæ­¥):            â”‚
â”‚  FOR k = 1 to nc:               â”‚
â”‚    Ts^(k+1) = f(Tg, Ts^k)       â”‚
â”‚    wl^(k+1) = çƒ­è§£è®¡ç®—           â”‚
â”‚  END FOR                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ååº”é€Ÿç‡è®¡ç®—:                   â”‚
â”‚  - å¼‚ç›¸ååº” (åŸºäº Ts_avg)        â”‚
â”‚  - å‡ç›¸ååº” (åŸºäº Tg)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èƒ½é‡å¹³è¡¡æ£€æŸ¥:                   â”‚
â”‚  htexc = H_rxn - H_out + H_in   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
       htexc â‰ˆ 0?
           â”œâ”€â”€ YES â†’ æ”¶æ•›
           â””â”€â”€ NO â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wegsteinæ›´æ–° Tg                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
     è¿”å›å›ºç›¸ç¬æ€æ±‚è§£
```

---

## ğŸ”¬ å…³é”®ç‰©ç†å‡è®¾

### 1. é¢—ç²’æ¸©åº¦ï¼ˆTsï¼‰
- **å‡åŒ€æ¸©åº¦**ï¼šBiotæ•°å°ï¼Œå†…éƒ¨æ¢¯åº¦å¿½ç•¥
- **å‡†ç¨³æ€ä¼ çƒ­**ï¼šæŒ‡æ•°è¡°å‡å½¢å¼
- **çƒå½¢é¢—ç²’**ï¼šå‡ ä½•å› å­ 3/r

### 2. æ°”ç›¸æ¸©åº¦ï¼ˆTgï¼‰
- **å®Œå…¨æ··åˆ**ï¼šCellå†…å‡åŒ€
- **å‡†ç¨³æ€**ï¼šæ°”ç›¸çƒ­å®¹å°
- **èƒ½é‡æº**ï¼šååº”çƒ­ - å£é¢æŸå¤±

### 3. æ¸©åº¦è€¦åˆ
- Tg â†’ Ts (è¾å°„+å¯¹æµ)
- Ts â†’ ååº”é€Ÿç‡ â†’ rheat â†’ Tg

---

## ğŸ“ ç‰¹æ®Šæ•°å€¼å¤„ç†

### 1. æŒ‡æ•°æº¢å‡ºä¿æŠ¤

```fortran
if(abs(ct) .gt. 25.) then
    ect = 1.0e-12
else 
    ect = exp(ct)
endif
```

### 2. å¤šåˆå€¼ç­–ç•¥ï¼ˆCell 0ï¼‰

```fortran
guesses_T = [400, 1000, 1500, 2000, 3000] K
```

### 3. å­æ­¥åˆ†å‰²

```fortran
nc = 20-50  ! å…¸å‹å€¼
```

---

## ğŸ’¡ ä¸æ‚¨çš„Pythonä»£ç å¯¹æ¯”

### Fortranä¼˜åŠ¿
âœ… è€ƒè™‘é¢—ç²’ç¬æ€ä¼ çƒ­
âœ… WegsteinåŠ é€Ÿï¼ˆå¿«3-5å€ï¼‰
âœ… è¯¦ç»†çƒ­è§£åŠ¨åŠ›å­¦

### Pythoné—®é¢˜
âŒ ä½¿ç”¨å‡ºå£æµ“åº¦ï¼ˆå¾ªç¯ä¾èµ–ï¼‰
âŒ æ— WegsteinåŠ é€Ÿ
âŒ æ— é¢—ç²’ç¬æ€æ±‚è§£

### å»ºè®®æ”¹è¿›
1. é‡‡ç”¨å…¥å£/å¹³å‡æµ“åº¦
2. å®ç°Wegsteinè¿­ä»£
3. æ·»åŠ é¢—ç²’çƒ­å¹³è¡¡å­å¾ªç¯
4. å¤šåˆå€¼çŒœæµ‹èµ·ç‡ƒ

---

## ğŸ“Š å…¸å‹è®¡ç®—ç¤ºä¾‹

```
Cell 0 (ç‡ƒçƒ§åŒº):
  Iteration 1: Tg = 2000K
    â†’ Ts: 300K â†’ 1850K (30 steps)
    â†’ htexc = +500 MW
    â†’ deltg = +300K
    â†’ Tg_new = 2300K

  Iteration 2: Tg = 2300K
    â†’ Ts: 300K â†’ 2100K
    â†’ htexc = +50 MW
    â†’ Wegstein â†’ Tg_new = 2350K

  Iteration 3: Tg = 2350K
    â†’ htexc = -5 MW âœ“
    
æœ€ç»ˆ: Tg = 2350K, Ts_avg = 2150K
```

---

## âœ… æ ¸å¿ƒè¦ç‚¹æ€»ç»“

**å› æœå…³ç³»æ¸…æ™°**ï¼š
```
Tg(å·²çŸ¥) â†’ Ts(æ±‚è§£) â†’ r(è®¡ç®—) â†’ htexc(æ£€æŸ¥) â†’ Tg(æ›´æ–°)
```

**NOT å¾ªç¯ä¾èµ–**ï¼š
```
Tg(æœªçŸ¥) â† â†’ Ts(æœªçŸ¥) âœ—
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆFortranä»£ç èƒ½æˆåŠŸæ”¶æ•›ï¼Œè€Œæ‚¨çš„Pythonä»£ç å‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼
